<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiAppDisertatieVacantaAI.Pages.ChatPage"
             Title="Chat AI"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource DarkGray}}">
    
    <!-- Main Grid with two views: Conversation List and Chat View -->
    <Grid RowDefinitions="Auto,*,Auto" Padding="10">
        <!-- Header -->
        <StackLayout Grid.Row="0" Orientation="Vertical" Spacing="8" Margin="0,20,0,25">
            <Label Text="ðŸ’¬ Conversatiile tale AI" 
                   FontSize="26" 
                   FontAttributes="Bold" 
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light={StaticResource DarkGray}, Dark={StaticResource White}}" />
            <Label Text="Selecteaza o conversatie existenta sau creaza una noua"
                   FontSize="14"
                   HorizontalOptions="Center"
                   HorizontalTextAlignment="Center"
                   TextColor="{AppThemeBinding Light={StaticResource MediumGray}, Dark={StaticResource LightGray}}"
                   Margin="20,0" />
        </StackLayout>

        <!-- Conversations List -->
        <ScrollView Grid.Row="1">
            <StackLayout>
                <!-- Loading Indicator -->
                <ActivityIndicator x:Name="LoadingIndicator" 
                                   IsRunning="False" 
                                   IsVisible="False" 
                                   Color="{StaticResource PrimaryBlue}" 
                                   VerticalOptions="Center" 
                                   Margin="0,20" />

                <!-- No Conversations Message -->
                <StackLayout x:Name="NoConversationsLabel" 
                             IsVisible="False"
                             VerticalOptions="Center" 
                             HorizontalOptions="Center"
                             Spacing="15"
                             Margin="40">
                    <Label Text="ðŸ¤–"
                           FontSize="60"
                           HorizontalOptions="Center"
                           Opacity="0.3" />
                    <Label Text="Nu ai inca conversatii"
                           FontSize="18"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource MediumGray}, Dark={StaticResource LightGray}}" />
                    <Label Text="Creaza prima ta conversatie AI pentru a incepe sa planifici vacante personalizate!"
                           FontSize="14"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"
                           TextColor="{AppThemeBinding Light={StaticResource MediumGray}, Dark={StaticResource LightGray}}"
                           Margin="0,5,0,0" />
                </StackLayout>

                <!-- Conversations Collection -->
                <CollectionView x:Name="ConversationsCollection" 
                                ItemsSource="{Binding}"
                                SelectionMode="None"
                                VerticalScrollBarVisibility="Never">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="0,5">
                                <SwipeView BackgroundColor="Transparent">
                                    <SwipeView.RightItems>
                                        <SwipeItems Mode="Reveal">
                                            <SwipeItem Text="âœï¸ Modifica"
                                                      BackgroundColor="{StaticResource PrimaryBlue}"
                                                      Command="{Binding Source={x:Reference ConversationsCollection}, Path=BindingContext.EditConversationCommand}"
                                                      CommandParameter="{Binding}" />
                                            <SwipeItem Text="ðŸ—‘ï¸ Sterge"
                                                      BackgroundColor="#E74C3C"
                                                      Command="{Binding Source={x:Reference ConversationsCollection}, Path=BindingContext.DeleteConversationCommand}"
                                                      CommandParameter="{Binding}" />
                                        </SwipeItems>
                                    </SwipeView.RightItems>
                                    
                                    <Frame BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource MediumGray}}"
                                           BorderColor="{AppThemeBinding Light=#E8E8E8, Dark=#404040}"
                                           CornerRadius="16"
                                           Padding="20,15"
                                           HasShadow="True"
                                           Margin="2">
                                        <Frame.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnConversationTapped" />
                                        </Frame.GestureRecognizers>
                                        
                                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                                            <!-- Conversation Info -->
                                            <StackLayout Grid.Column="0" Spacing="6">
                                                <Label Text="{Binding Denumire}" 
                                                       FontSize="16" 
                                                       FontAttributes="Bold"
                                                       TextColor="{AppThemeBinding Light={StaticResource DarkGray}, Dark={StaticResource White}}" 
                                                       LineBreakMode="TailTruncation"
                                                       MaxLines="1" />
                                                <Label Text="{Binding FormattedDate}" 
                                                       FontSize="12"
                                                       TextColor="{AppThemeBinding Light={StaticResource MediumGray}, Dark={StaticResource LightGray}}" />
                                            </StackLayout>
                                            
                                            <!-- Visual Indicator -->
                                            <Label Grid.Column="1"
                                                   Text="ðŸ’¬"
                                                   FontSize="20"
                                                   VerticalOptions="Center"
                                                   Opacity="0.6" />
                                        </Grid>
                                    </Frame>
                                </SwipeView>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </StackLayout>
        </ScrollView>

        <!-- New Conversation Button -->
        <Button Grid.Row="2" 
                x:Name="NewConversationButton"
                Text="âœ¨ Conversatie Noua"
                BackgroundColor="{StaticResource PrimaryBlue}"
                TextColor="White"
                FontSize="16"
                FontAttributes="Bold"
                CornerRadius="16"
                Padding="20,15"
                Margin="0,25,0,15"
                Clicked="OnNewConversationClicked"
                Shadow="{OnPlatform Default={x:Null}, iOS={Shadow Brush=Black, Offset='0,2', Radius=4, Opacity=0.3}}" />
    </Grid>
</ContentPage>