<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiAppDisertatieVacantaAI.Pages.SugestiiPage"
             Title="Sugestii"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource DarkGray}}">

    <Grid RowDefinitions="Auto,*,Auto" Padding="15">
        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Spacing="6" Margin="0,10,0,15">
            <Label Text="✈️ Sugestiile Tale" 
                   FontSize="24" 
                   FontAttributes="Bold" 
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light={StaticResource DarkGray}, Dark={StaticResource White}}" />
            <Label Text="Planuri de vacanta personalizate"
                   FontSize="13"
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light={StaticResource MediumGray}, Dark={StaticResource LightGray}}"
                   Opacity="0.8" />
        </VerticalStackLayout>

        <!-- Content Area -->
        <ScrollView Grid.Row="1">
            <StackLayout>
                <!-- Loading Indicator -->
                <ActivityIndicator x:Name="LoadingIndicator" 
                                   IsRunning="False" 
                                   IsVisible="False" 
                                   Color="{StaticResource PrimaryBlue}" 
                                   VerticalOptions="Center" 
                                   Margin="0,20" />

                <!-- Empty State -->
                <StackLayout x:Name="EmptyStateView" 
                             IsVisible="False"
                             VerticalOptions="Center" 
                             HorizontalOptions="Center"
                             Spacing="12"
                             Margin="40">
                    <Label Text="🌴"
                           FontSize="50"
                           HorizontalOptions="Center"
                           Opacity="0.3" />
                    <Label Text="Nu ai inca sugestii"
                           FontSize="16"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource MediumGray}, Dark={StaticResource LightGray}}" />
                    <Label Text="Creaza prima ta sugestie de vacanta!"
                           FontSize="13"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"
                           TextColor="{AppThemeBinding Light={StaticResource MediumGray}, Dark={StaticResource LightGray}}"
                           Opacity="0.7" />
                </StackLayout>

                <!-- Suggestions Collection -->
                <CollectionView x:Name="SugestiiCollection" 
                                ItemsSource="{Binding}"
                                SelectionMode="None"
                                VerticalScrollBarVisibility="Never">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="0,4">
                                <Frame BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource MediumGray}}"
                                       BorderColor="{AppThemeBinding Light=#E8E8E8, Dark=#404040}"
                                       CornerRadius="12"
                                       Padding="12"
                                       HasShadow="True"
                                       Margin="0,2">
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnSugestieSelected" />
                                    </Frame.GestureRecognizers>

                                    <!-- Main Content Grid with overlay for status indicators -->
                                    <Grid>
                                        <!-- Base content in a horizontal layout -->
                                        <Grid ColumnDefinitions="80,*" ColumnSpacing="12">

                                            <!-- Left: Destination Image -->
                                            <Border Grid.Column="0" 
                                                    StrokeShape="RoundRectangle 8"
                                                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                                                    StrokeThickness="1"
                                                    BackgroundColor="{AppThemeBinding Light={StaticResource LightGray}, Dark={StaticResource MediumGray}}">
                                                <Image Source="{Binding ImageUrl}"
                                                       Aspect="AspectFill"
                                                       WidthRequest="80"
                                                       HeightRequest="60" />
                                            </Border>

                                            <!-- Right: Content -->
                                            <StackLayout Grid.Column="1" 
                                                         Spacing="4"
                                                         VerticalOptions="Center">

                                                <!-- Title -->
                                                <Label Text="{Binding Titlu}" 
                                                       FontSize="15" 
                                                       FontAttributes="Bold"
                                                       TextColor="{AppThemeBinding Light={StaticResource DarkGray}, Dark={StaticResource White}}" 
                                                       LineBreakMode="TailTruncation"
                                                       MaxLines="1"
                                                       Margin="0,0,50,0" />

                                                <!-- Destination -->
                                                <Label Text="{Binding Destinatie.Denumire}" 
                                                       FontSize="13" 
                                                       TextColor="{StaticResource PrimaryBlue}" 
                                                       FontAttributes="Italic"
                                                       LineBreakMode="TailTruncation" />

                                                <!-- Budget -->
                                                <Label Text="{Binding Buget_Estimat, StringFormat='💰 {0:N0} €'}" 
                                                       FontSize="12" 
                                                       TextColor="{AppThemeBinding Light={StaticResource MediumGray}, Dark={StaticResource LightGray}}" 
                                                       FontAttributes="Bold"
                                                       VerticalOptions="Start" />
                                            </StackLayout>
                                        </Grid>

                                        <!-- Overlaid Status Indicators - Top Right -->
                                        <StackLayout Orientation="Horizontal"
                                                     Spacing="4"
                                                     VerticalOptions="Start"
                                                     HorizontalOptions="End"
                                                     Margin="0,0,0,0">

                                            <!-- AI Generated Indicator -->
                                            <Label Text="🤖"
                                                   FontSize="15"
                                                   IsVisible="{Binding ShowAIIndicator}"
                                                   VerticalOptions="Center"
                                                   HorizontalOptions="Center" />

                                            <!-- Manual Generated Indicator -->
                                            <Label Text="👤"
                                                   FontSize="15"
                                                   IsVisible="{Binding ShowManualIndicator}"
                                                   VerticalOptions="Center"
                                                   HorizontalOptions="Center" />

                                            <!-- New Indicator -->
                                            <Label Text="🆕"
                                                   FontSize="15"
                                                   IsVisible="{Binding ShowNewIndicator}"
                                                   VerticalOptions="Center"
                                                   HorizontalOptions="Center" />
                                        </StackLayout>

                                        <!-- Date - Bottom Right Corner -->
                                        <Label Text="{Binding Data_Inregistrare, StringFormat='{0:dd/MM/yyyy}'}" 
                                               FontSize="10" 
                                               TextColor="{AppThemeBinding Light={StaticResource MediumGray}, Dark={StaticResource LightGray}}" 
                                               Opacity="0.6"
                                               VerticalOptions="End"
                                               HorizontalOptions="End"
                                               Margin="0,0,0,0" />
                                    </Grid>
                                </Frame>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </StackLayout>
        </ScrollView>

        <!-- Add New Suggestion Button -->
        <Button Grid.Row="2" 
                x:Name="AddSugestieButton"
                Text="✨ Sugestie Noua"
                BackgroundColor="{StaticResource PrimaryBlue}"
                TextColor="White"
                FontSize="15"
                FontAttributes="Bold"
                CornerRadius="12"
                Padding="0,12"
                Margin="0,15,0,10"
                Clicked="OnAddSugestie" />
    </Grid>
</ContentPage>